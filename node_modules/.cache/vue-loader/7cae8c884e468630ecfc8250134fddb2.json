{"remainingRequest":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\src\\components\\userinfo\\user.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\src\\components\\userinfo\\user.vue","mtime":1666923644919},{"path":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665973319926},{"path":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\node_modules\\babel-loader\\lib\\index.js","mtime":1665973384882},{"path":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1665973319926},{"path":"C:\\Users\\12486\\Desktop\\中软\\PopularizeLaw\\PopularizeLaw\\node_modules\\vue-loader\\lib\\index.js","mtime":1665973372199}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport { logout, integralTotal, findTotalIntegral } from '../../request/onlinetimeRequest'\r\n\r\nimport moment from \"moment\";\r\nimport axios from 'axios';\r\nexport default {\r\n  name: \"user\",\r\n  beforeRouteEnter: (to, from, next) => {\r\n    next((vm) => {\r\n      vm.getData();\r\n    });\r\n  },\r\n  data() {\r\n    return {\r\n      show: false,\r\n      userid: localStorage.userid,\r\n      logouttime: localStorage.logouttime,\r\n      logintime: localStorage.logintime,\r\n      onlinetime: '',\r\n      integral: '',\r\n      username: '',\r\n      photo: '',\r\n      avatarVisible: false,\r\n      lawList:[]\r\n    };\r\n  },\r\n  methods: {\r\n    getData() {\r\n      this.show = true;\r\n    },\r\n    handleOpen(key, keyPath) {\r\n      console.log(\"打开：\", key, keyPath);\r\n    },\r\n    handleClose(key, keyPath) {\r\n      console.log(\"关闭：\", key, keyPath);\r\n    },\r\n    handSelect(key, keyPath) {\r\n      console.log(\"选择：\", key, keyPath);\r\n    },\r\n    logout() {\r\n      this.$message({\r\n        type: 'success',\r\n        message: '成功退出！欢迎下次登录！'\r\n      });\r\n      this.getTimeDiff()\r\n      logout(this.userid, this.onlinetime, this.integral).then(res => {\r\n        if (res.data == 1) {\r\n          this.integralTotal();\r\n          this.$router.push(\"/login\");\r\n        }\r\n        // localStorage.clear();\r\n      })\r\n    },\r\n    integralTotal() {\r\n      integralTotal(this.userid).then(res => {\r\n        if (res.data == 1) {\r\n        }\r\n      })\r\n    },\r\n    findTotalIntegral() {\r\n      findTotalIntegral(this.userid).then(res => {\r\n        this.username = res.data[0].username\r\n        this.photo = res.data[0].photo\r\n      })\r\n    },\r\n    getTimeDiff() {\r\n      this.logouttime = new Date();\r\n      var outtime = moment(this.logouttime).format('HH:mm:ss')\r\n      localStorage.setItem('logouttime', outtime)\r\n      let diff = moment(this.logouttime).format('x') - moment(this.logintime).format('x');\r\n      let time = moment.duration(diff);\r\n      let hours = time.hours();//小时差\r\n      let minutes = time.minutes();//分钟差\r\n      this.onlinetime = minutes + hours * 60;\r\n      this.integral = this.onlinetime * 5;\r\n    },\r\n\r\n    uploadAvatarImage(file, filelist) {\r\n      const that = this;\r\n      if (filelist.length > 0) {\r\n        this.fileList = [filelist[filelist.length - 1]] //这一步，是 展示最后一次选择文件\r\n        let formData = new FormData();\r\n        formData.append(\"file\", this.fileList[0].raw);\r\n        console.log(formData.get(\"file\"));\r\n\r\n        var instance = axios.create({\r\n          baseURL: 'http://www.xiehanxin.com:8080/index.php/',\r\n          timeout: 5000,\r\n          headers: {\r\n            \"Content-Type\": \"multipart/form-data\"\r\n          }\r\n        });\r\n\r\n        instance.post(`backend/Register/upload?userid=${this.userid}`, formData)\r\n          .then((res) => {\r\n            console.log(res);\r\n            if (res.data.code == 1) {\r\n              this.$message(res.data.message);\r\n              this.updataAvatar = res.data.path;\r\n              findTotalIntegral(this.userid).then(res => {\r\n                this.photo = res.data[0].photo\r\n              })\r\n            } else {\r\n              this.$message(res.data.message);\r\n            }\r\n          }).catch((err) => {\r\n            this.$message.error('上传失败');\r\n            console.log('上传失败', err)\r\n\r\n          })\r\n      }\r\n    },\r\n    change() {\r\n      this.avatarVisible = true;\r\n    },\r\n    handleEditAvatar() {\r\n      this.avatarVisible = false;\r\n      this.$router.go(0);\r\n    }\r\n\r\n\r\n\r\n  },\r\n  mounted() {\r\n  },\r\n  created() {\r\n    this.findTotalIntegral()\r\n   \r\n  }\r\n};\r\n",{"version":3,"sources":["user.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"user.vue","sourceRoot":"src/components/userinfo","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"user-box\">\r\n      <el-container>\r\n        <transition name=\"el-zoom-in-top\">\r\n          <el-aside>\r\n            <el-header>\r\n              <el-card class=\"card1\">\r\n                <el-row>\r\n                  <img :src=\"this.photo\" @click=\"change()\" style=\"width:70px;height: 70px;border-radius: 70px;\">\r\n                </el-row>\r\n                <el-row>\r\n                  <el-dialog title=\"更换头像\" :visible.sync=\"avatarVisible\" width=\"22%\" center>\r\n                    <el-upload action=\"\" list-type=\"picture-card\" accept=\"image/jpg,image/jpeg,image/png\"\r\n                      :on-change=\"uploadAvatarImage\" :auto-upload=\"false\" :limit=\"1\">\r\n                      <img :src=\"this.photo\" alt=\"\" srcset=\"\" style=\"width:170px;height:170px;\">\r\n\r\n                    </el-upload>\r\n                    <span slot=\"footer\" class=\"dialog-footer\">\r\n                      <el-button @click=\"avatarVisible = false\">取 消</el-button>\r\n                      <el-button type=\"primary\" @click=\"handleEditAvatar\">确 定</el-button>\r\n                    </span>\r\n                  </el-dialog>\r\n\r\n                </el-row>\r\n                <el-row>\r\n                  <span style=\"color:white\">{{ username }}</span>\r\n                </el-row>\r\n                <el-row class=\"logout\">\r\n                  <el-button @click=\"logout\" class=\"out\">退出登录</el-button>\r\n                </el-row>\r\n              </el-card>\r\n            </el-header>\r\n            <el-menu @open=\"handleOpen\" @close=\"handleClose\" @select=\"handSelect\">\r\n              <el-card class=\"card2\">\r\n                <el-menu-item index=\"1\">\r\n                  <template slot=\"title\">\r\n                    <i class=\"el-icon-user-solid\"></i>\r\n                    <router-link to=\"/UserInfo/info1\"><span>基本资料</span></router-link>\r\n                  </template>\r\n                </el-menu-item>\r\n\r\n                <el-submenu index=\"2\">\r\n                  <template slot=\"title\"><i class=\"el-icon-star-on\"></i><span>我的收藏</span></template>\r\n                  <el-menu-item-group>\r\n                    <el-menu-item index=\"2-1\">\r\n                      <router-link to=\"/UserInfo/info2\">法律条例</router-link>\r\n                    </el-menu-item>\r\n                    <el-menu-item index=\"2-2\">\r\n                      <router-link to=\"/UserInfo/info3\">相关案例</router-link>\r\n                    </el-menu-item>\r\n                    <!-- <el-menu-item index=\"2-3\">\r\n                      <router-link to=\"/UserInfo/info4\">权益条例</router-link>\r\n                    </el-menu-item> -->\r\n                  </el-menu-item-group>\r\n                </el-submenu>\r\n\r\n                <el-submenu index=\"3\">\r\n                  <template slot=\"title\"><i class=\"el-icon-setting\"></i><span>积分明细</span></template>\r\n                  <el-menu-item-group>\r\n                    <el-menu-item index=\"3-1\">\r\n                      <router-link to=\"/UserInfo/userIntegraiDetail\">在线时长所得</router-link>\r\n                    </el-menu-item>\r\n                  </el-menu-item-group>\r\n                </el-submenu>\r\n\r\n                <el-submenu index=\"4\">\r\n                  <template slot=\"title\"><i class=\"el-icon-setting\"></i><span>举报记录</span></template>\r\n                  <el-menu-item-group>\r\n                    <el-menu-item index=\"4-1\">\r\n                      <router-link to=\"/UserInfo/reportRecord\">举报情况查询</router-link>\r\n                    </el-menu-item>\r\n                  </el-menu-item-group>\r\n                </el-submenu>\r\n              </el-card>\r\n            </el-menu>\r\n          </el-aside>\r\n        </transition>\r\n        <el-container>\r\n          <el-main>\r\n            <router-view />\r\n          </el-main>\r\n        </el-container>\r\n      </el-container>\r\n    </div>\r\n  </div>\r\n</template>\r\n  \r\n<script>\r\nimport { logout, integralTotal, findTotalIntegral } from '../../request/onlinetimeRequest'\r\n\r\nimport moment from \"moment\";\r\nimport axios from 'axios';\r\nexport default {\r\n  name: \"user\",\r\n  beforeRouteEnter: (to, from, next) => {\r\n    next((vm) => {\r\n      vm.getData();\r\n    });\r\n  },\r\n  data() {\r\n    return {\r\n      show: false,\r\n      userid: localStorage.userid,\r\n      logouttime: localStorage.logouttime,\r\n      logintime: localStorage.logintime,\r\n      onlinetime: '',\r\n      integral: '',\r\n      username: '',\r\n      photo: '',\r\n      avatarVisible: false,\r\n      lawList:[]\r\n    };\r\n  },\r\n  methods: {\r\n    getData() {\r\n      this.show = true;\r\n    },\r\n    handleOpen(key, keyPath) {\r\n      console.log(\"打开：\", key, keyPath);\r\n    },\r\n    handleClose(key, keyPath) {\r\n      console.log(\"关闭：\", key, keyPath);\r\n    },\r\n    handSelect(key, keyPath) {\r\n      console.log(\"选择：\", key, keyPath);\r\n    },\r\n    logout() {\r\n      this.$message({\r\n        type: 'success',\r\n        message: '成功退出！欢迎下次登录！'\r\n      });\r\n      this.getTimeDiff()\r\n      logout(this.userid, this.onlinetime, this.integral).then(res => {\r\n        if (res.data == 1) {\r\n          this.integralTotal();\r\n          this.$router.push(\"/login\");\r\n        }\r\n        // localStorage.clear();\r\n      })\r\n    },\r\n    integralTotal() {\r\n      integralTotal(this.userid).then(res => {\r\n        if (res.data == 1) {\r\n        }\r\n      })\r\n    },\r\n    findTotalIntegral() {\r\n      findTotalIntegral(this.userid).then(res => {\r\n        this.username = res.data[0].username\r\n        this.photo = res.data[0].photo\r\n      })\r\n    },\r\n    getTimeDiff() {\r\n      this.logouttime = new Date();\r\n      var outtime = moment(this.logouttime).format('HH:mm:ss')\r\n      localStorage.setItem('logouttime', outtime)\r\n      let diff = moment(this.logouttime).format('x') - moment(this.logintime).format('x');\r\n      let time = moment.duration(diff);\r\n      let hours = time.hours();//小时差\r\n      let minutes = time.minutes();//分钟差\r\n      this.onlinetime = minutes + hours * 60;\r\n      this.integral = this.onlinetime * 5;\r\n    },\r\n\r\n    uploadAvatarImage(file, filelist) {\r\n      const that = this;\r\n      if (filelist.length > 0) {\r\n        this.fileList = [filelist[filelist.length - 1]] //这一步，是 展示最后一次选择文件\r\n        let formData = new FormData();\r\n        formData.append(\"file\", this.fileList[0].raw);\r\n        console.log(formData.get(\"file\"));\r\n\r\n        var instance = axios.create({\r\n          baseURL: 'http://www.xiehanxin.com:8080/index.php/',\r\n          timeout: 5000,\r\n          headers: {\r\n            \"Content-Type\": \"multipart/form-data\"\r\n          }\r\n        });\r\n\r\n        instance.post(`backend/Register/upload?userid=${this.userid}`, formData)\r\n          .then((res) => {\r\n            console.log(res);\r\n            if (res.data.code == 1) {\r\n              this.$message(res.data.message);\r\n              this.updataAvatar = res.data.path;\r\n              findTotalIntegral(this.userid).then(res => {\r\n                this.photo = res.data[0].photo\r\n              })\r\n            } else {\r\n              this.$message(res.data.message);\r\n            }\r\n          }).catch((err) => {\r\n            this.$message.error('上传失败');\r\n            console.log('上传失败', err)\r\n\r\n          })\r\n      }\r\n    },\r\n    change() {\r\n      this.avatarVisible = true;\r\n    },\r\n    handleEditAvatar() {\r\n      this.avatarVisible = false;\r\n      this.$router.go(0);\r\n    }\r\n\r\n\r\n\r\n  },\r\n  mounted() {\r\n  },\r\n  created() {\r\n    this.findTotalIntegral()\r\n   \r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.out {\r\n  border-radius: 5px;\r\n  background: gainsboro;\r\n}\r\n\r\n.user-box {\r\n  display: block;\r\n  position: absolute;\r\n  margin-top: 20px;\r\n  font-size: 18px;\r\n}\r\n\r\n.el-header {\r\n  color: #333;\r\n  min-height: 210px;\r\n}\r\n\r\n.el-aside {\r\n  color: #333;\r\n  margin-bottom: 50px;\r\n  /* min-height: 890px; */\r\n}\r\n\r\n.el-menu {\r\n  background-color: #f2f6fc;\r\n  /* padding: 10px; */\r\n}\r\n\r\n.el-menu-item {\r\n  height: 50px;\r\n  line-height: 50px;\r\n  font-size: 22px;\r\n}\r\n\r\n.el-submenu /deep/ .el-submenu__title {\r\n  height: 50px;\r\n  line-height: 50px;\r\n  font-size: 22px;\r\n}\r\n\r\n.el-menu-item-group .el-menu-item {\r\n  font-size: 17px;\r\n}\r\n\r\n.el-menu-item.is-active {\r\n  background-color: rgba(215, 0, 15, 1) !important;\r\n  color: yellow;\r\n}\r\n\r\n.el-menu-item:hover {\r\n  border-left: rgba(215, 0, 15, 1) solid 6px !important;\r\n  background-color: #E2EFF9 !important;\r\n  color: rgba(215, 0, 15, 1) !important;\r\n}\r\n\r\n.el-menu-item.is-active span {\r\n  color: yellow !important;\r\n}\r\n\r\n.el-submenu.is-active>.el-submenu__title span {\r\n  color: yellow !important;\r\n}\r\n\r\n/* icon图标也跟着变 */\r\n.el-submenu.is-active>.el-submenu__title i {\r\n  color: yellow !important;\r\n}\r\n\r\n.el-avatar {\r\n  margin: 15px auto;\r\n}\r\n\r\n.logout {\r\n  margin: 15px auto;\r\n}\r\n\r\n.card1 {\r\n  background-color: rgba(215, 0, 15, 1);\r\n  position: relative;\r\n}\r\n\r\n.card2 {\r\n  /* background-color: #F2F6FC; */\r\n  position: relative;\r\n}\r\n\r\n.router-link .el-menu-item {\r\n  background-color: #f2f6fc;\r\n}\r\n\r\n.router-link-active {\r\n  text-decoration: none;\r\n}\r\n\r\na {\r\n  text-decoration: none;\r\n  color: #333;\r\n}\r\n</style>\r\n  "]}]}